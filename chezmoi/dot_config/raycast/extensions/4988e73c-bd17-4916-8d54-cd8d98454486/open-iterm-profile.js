"use strict";var te=Object.create;var k=Object.defineProperty;var re=Object.getOwnPropertyDescriptor;var ne=Object.getOwnPropertyNames;var ae=Object.getPrototypeOf,se=Object.prototype.hasOwnProperty;var ie=(r,t)=>{for(var e in t)k(r,e,{get:t[e],enumerable:!0})},C=(r,t,e,n)=>{if(t&&typeof t=="object"||typeof t=="function")for(let a of ne(t))!se.call(r,a)&&a!==e&&k(r,a,{get:()=>t[a],enumerable:!(n=re(t,a))||n.enumerable});return r};var y=(r,t,e)=>(e=r!=null?te(ae(r)):{},C(t||!r||!r.__esModule?k(e,"default",{value:r,enumerable:!0}):e,r)),oe=r=>C(k({},"__esModule",{value:!0}),r);var we={};ie(we,{default:()=>Z});module.exports=oe(we);var c=require("@raycast/api");var m=y(require("react")),u=require("@raycast/api");var M=y(require("node:child_process")),D=require("node:buffer"),b=y(require("node:stream")),W=require("node:util");var N=require("react/jsx-runtime");var S=globalThis;var x=r=>!!r&&typeof r=="object"&&typeof r.removeListener=="function"&&typeof r.emit=="function"&&typeof r.reallyExit=="function"&&typeof r.listeners=="function"&&typeof r.kill=="function"&&typeof r.pid=="number"&&typeof r.on=="function",E=Symbol.for("signal-exit emitter"),A=class{constructor(){if(this.emitted={afterExit:!1,exit:!1},this.listeners={afterExit:[],exit:[]},this.count=0,this.id=Math.random(),S[E])return S[E];Object.defineProperty(S,E,{value:this,writable:!1,enumerable:!1,configurable:!1})}on(t,e){this.listeners[t].push(e)}removeListener(t,e){let n=this.listeners[t],a=n.indexOf(e);a!==-1&&(a===0&&n.length===1?n.length=0:n.splice(a,1))}emit(t,e,n){if(this.emitted[t])return!1;this.emitted[t]=!0;let a=!1;for(let s of this.listeners[t])a=s(e,n)===!0||a;return t==="exit"&&(a=this.emit("afterExit",e,n)||a),a}},T=class{onExit(){return()=>{}}load(){}unload(){}},R=class{#o;#t;#e;#s;#i;#a;#n;#r;constructor(t){this.#o=process.platform==="win32"?"SIGINT":"SIGHUP",this.#t=new A,this.#a={},this.#n=!1,this.#r=[],this.#r.push("SIGHUP","SIGINT","SIGTERM"),globalThis.process.platform!=="win32"&&this.#r.push("SIGALRM","SIGABRT","SIGVTALRM","SIGXCPU","SIGXFSZ","SIGUSR2","SIGTRAP","SIGSYS","SIGQUIT","SIGIOT"),globalThis.process.platform==="linux"&&this.#r.push("SIGIO","SIGPOLL","SIGPWR","SIGSTKFLT"),this.#e=t,this.#a={};for(let e of this.#r)this.#a[e]=()=>{let n=this.#e.listeners(e),{count:a}=this.#t,s=t;if(typeof s.__signal_exit_emitter__=="object"&&typeof s.__signal_exit_emitter__.count=="number"&&(a+=s.__signal_exit_emitter__.count),n.length===a){this.unload();let i=this.#t.emit("exit",null,e),o=e==="SIGHUP"?this.#o:e;i||t.kill(t.pid,o)}};this.#i=t.reallyExit,this.#s=t.emit}onExit(t,e){if(!x(this.#e))return()=>{};this.#n===!1&&this.load();let n=e?.alwaysLast?"afterExit":"exit";return this.#t.on(n,t),()=>{this.#t.removeListener(n,t),this.#t.listeners.exit.length===0&&this.#t.listeners.afterExit.length===0&&this.unload()}}load(){if(!this.#n){this.#n=!0,this.#t.count+=1;for(let t of this.#r)try{let e=this.#a[t];e&&this.#e.on(t,e)}catch{}this.#e.emit=(t,...e)=>this.#l(t,...e),this.#e.reallyExit=t=>this.#c(t)}}unload(){this.#n&&(this.#n=!1,this.#r.forEach(t=>{let e=this.#a[t];if(!e)throw new Error("Listener not defined for signal: "+t);try{this.#e.removeListener(t,e)}catch{}}),this.#e.emit=this.#s,this.#e.reallyExit=this.#i,this.#t.count-=1)}#c(t){return x(this.#e)?(this.#e.exitCode=t||0,this.#t.emit("exit",this.#e.exitCode,null),this.#i.call(this.#e,this.#e.exitCode)):0}#l(t,...e){let n=this.#s;if(t==="exit"&&x(this.#e)){typeof e[0]=="number"&&(this.#e.exitCode=e[0]);let a=n.call(this.#e,t,...e);return this.#t.emit("exit",this.#e.exitCode,null),a}else return n.call(this.#e,t,...e)}},P=null,ce=(r,t)=>(P||(P=x(process)?new R(process):new T),P.onExit(r,t));function le(r,{timeout:t}={}){let e=new Promise((o,l)=>{r.on("exit",(f,h)=>{o({exitCode:f,signal:h,timedOut:!1})}),r.on("error",f=>{l(f)}),r.stdin&&r.stdin.on("error",f=>{l(f)})}),n=ce(()=>{r.kill()});if(t===0||t===void 0)return e.finally(()=>n());let a,s=new Promise((o,l)=>{a=setTimeout(()=>{r.kill("SIGTERM"),l(Object.assign(new Error("Timed out"),{timedOut:!0,signal:"SIGTERM"}))},t)}),i=e.finally(()=>{clearTimeout(a)});return Promise.race([s,i]).finally(()=>n())}var _=class extends Error{constructor(){super("The output is too big"),this.name="MaxBufferError"}};function ue(r){let{encoding:t}=r,e=t==="buffer",n=new b.default.PassThrough({objectMode:!1});t&&t!=="buffer"&&n.setEncoding(t);let a=0,s=[];return n.on("data",i=>{s.push(i),a+=i.length}),n.getBufferedValue=()=>e?Buffer.concat(s,a):s.join(""),n.getBufferedLength=()=>a,n}async function I(r,t){let e=ue(t);return await new Promise((n,a)=>{let s=i=>{i&&e.getBufferedLength()<=D.constants.MAX_LENGTH&&(i.bufferedData=e.getBufferedValue()),a(i)};(async()=>{try{await(0,W.promisify)(b.default.pipeline)(r,e),n()}catch(i){s(i)}})(),e.on("data",()=>{e.getBufferedLength()>8e7&&s(new _)})}),e.getBufferedValue()}async function O(r,t){r.destroy();try{return await t}catch(e){return e.bufferedData}}async function fe({stdout:r,stderr:t},{encoding:e},n){let a=I(r,{encoding:e}),s=I(t,{encoding:e});try{return await Promise.all([n,a,s])}catch(i){return Promise.all([{error:i,exitCode:null,signal:i.signal,timedOut:i.timedOut||!1},O(r,a),O(t,s)])}}function de(r){let t=typeof r=="string"?`
`:10,e=typeof r=="string"?"\r":13;return r[r.length-1]===t&&(r=r.slice(0,-1)),r[r.length-1]===e&&(r=r.slice(0,-1)),r}function L(r,t){return r.stripFinalNewline?de(t):t}function he({timedOut:r,timeout:t,signal:e,exitCode:n}){return r?`timed out after ${t} milliseconds`:e!=null?`was killed with ${e}`:n!=null?`failed with exit code ${n}`:"failed"}function pe({stdout:r,stderr:t,error:e,signal:n,exitCode:a,command:s,timedOut:i,options:o,parentError:l}){let h=`Command ${he({timedOut:i,timeout:o?.timeout,signal:n,exitCode:a})}: ${s}`,w=e?`${h}
${e.message}`:h,v=[w,t,r].filter(Boolean).join(`
`);return e?e.originalMessage=e.message:e=l,e.message=v,e.shortMessage=w,e.command=s,e.exitCode=a,e.signal=n,e.stdout=r,e.stderr=t,"bufferedData"in e&&delete e.bufferedData,e}function me({stdout:r,stderr:t,error:e,exitCode:n,signal:a,timedOut:s,command:i,options:o,parentError:l}){if(e||n!==0||a!==null)throw pe({error:e,exitCode:n,signal:a,stdout:r,stderr:t,command:i,timedOut:s,options:o,parentError:l});return r}async function z(r,t,e){if(process.platform!=="darwin")throw new Error("AppleScript is only supported on macOS");let{humanReadableOutput:n,language:a,timeout:s,...i}=Array.isArray(t)?e||{}:t||{},o=n!==!1?[]:["-ss"];a==="JavaScript"&&o.push("-l","JavaScript"),Array.isArray(t)&&o.push("-",...t);let l=M.default.spawn("osascript",o,{...i,env:{PATH:"/usr/local/bin:/usr/bin:/bin:/usr/sbin:/sbin"}}),f=le(l,{timeout:s??1e4});l.stdin.end(r);let[{error:h,exitCode:w,signal:v,timedOut:q},Y,X]=await fe(l,{encoding:"utf8"},f),Q=L({stripFinalNewline:!0},Y),ee=L({stripFinalNewline:!0},X);return me({stdout:Q,stderr:ee,error:h,exitCode:w,signal:v,timedOut:q,command:"osascript",options:e,parentError:new Error})}var $=require("react");var V=require("child_process"),F=require("os"),j=require("path");function B(){let r=(0,j.join)((0,F.homedir)(),"Library/Preferences/com.googlecode.iterm2.plist");try{let e=(0,V.execSync)(`/usr/libexec/PlistBuddy -c "Print :New\\ Bookmarks" "${r}" 2>/dev/null | grep -E "Name =|Guid ="`,{encoding:"utf-8"}).trim().split(`
`),n=[];for(let a=0;a<e.length;a+=2){let s=e[a],i=e[a+1];if(s&&i){let o=s.match(/Guid\s*=\s*(.+)/),l=i.match(/Name\s*=\s*(.+)/);l&&o&&n.push({name:l[1].trim(),guid:o[1].trim()})}}return n}catch(t){return console.error("Failed to read iTerm profiles:",t),[]}}var d=require("@raycast/api"),K=y(require("path"));var G=y(require("path"),1);function U(r,t={}){if(typeof r!="string")throw new TypeError(`Expected a string, got ${typeof r}`);let{resolve:e=!0}=t,n=r;return e&&(n=G.default.resolve(r)),n=n.replace(/\\/g,"/"),n[0]!=="/"&&(n=`/${n}`),encodeURI(`file://${n}`).replace(/[?#]/g,encodeURIComponent)}var g=require("react/jsx-runtime"),be=()=>(0,g.jsx)(d.Action.Open,{title:"Open System Preferences",icon:d.Icon.Gear,target:"x-apple.systempreferences:com.apple.preference.security?Privacy_AllFiles"}),ge=()=>(0,g.jsx)(d.ActionPanel,{children:(0,g.jsx)(be,{})}),$e=`## Raycast needs automation access to iTerm.

1. Open **System Settings**
1. Open the **Privacy & Security** Preferences pane 
1. Then select the **Automation** tab
1. Expand **Raycast** from the list of applications
1. Ensure the **iTerm**  toggle is enabled as shown in the image below
1. When prompted enter your password

![Full Disk Access Preferences Pane](${U(K.default.join(d.environment.assetsPath,"permission-raycast-automation.png"))})
`,H=r=>r.indexOf("Command failed with exit code 1: osascript -e")!==-1,J=()=>(0,g.jsx)(d.Detail,{markdown:$e,navigationTitle:"Permission Issue with Raycast",actions:(0,g.jsx)(ge,{})});var p=require("react/jsx-runtime");function ye(r,t){let e=r.replace(/"/g,'\\"');return t==="window"?`
      tell application "iTerm"
        launch
        repeat until application "iTerm" is running
          delay 0.1
        end repeat

        create window with profile "${e}"
        activate
      end tell
    `:`
      tell application "iTerm"
        launch
        repeat until application "iTerm" is running
          delay 0.1
        end repeat

        if windows of application "iTerm" is {} then
          create window with profile "${e}"
        else
          tell current window
            create tab with profile "${e}"
          end tell
        end if
        activate
      end tell
    `}function Z(){let[r,t]=(0,$.useState)([]),[e,n]=(0,$.useState)(!0),[a,s]=(0,$.useState)(!1);(0,$.useEffect)(()=>{let o=B();t(o),n(!1)},[]);let i=async(o,l)=>{try{let f=ye(o.name,l);await z(f),await(0,c.closeMainWindow)(),await(0,c.popToRoot)()}catch(f){let h=f;if(H(h.message)){s(!0);return}await(0,c.showToast)({style:c.Toast.Style.Failure,title:`Cannot open profile "${o.name}"`,message:h.message})}};return a?(0,p.jsx)(J,{}):(0,p.jsxs)(c.List,{isLoading:e,searchBarPlaceholder:"Search iTerm profiles...",children:[r.map(o=>(0,p.jsx)(c.List.Item,{icon:c.Icon.Terminal,title:o.name,actions:(0,p.jsxs)(c.ActionPanel,{children:[(0,p.jsx)(c.Action,{title:"Open in New Window",icon:c.Icon.Window,onAction:()=>i(o,"window")}),(0,p.jsx)(c.Action,{title:"Open in New Tab",icon:c.Icon.Plus,onAction:()=>i(o,"tab")})]})},o.guid)),!e&&r.length===0&&(0,p.jsx)(c.List.EmptyView,{icon:c.Icon.ExclamationMark,title:"No profiles found",description:"Could not find any iTerm profiles. Make sure iTerm2 is installed."})]})}
