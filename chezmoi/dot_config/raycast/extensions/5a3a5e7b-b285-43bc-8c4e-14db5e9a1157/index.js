"use strict";var k=Object.defineProperty;var L=Object.getOwnPropertyDescriptor;var R=Object.getOwnPropertyNames;var E=Object.prototype.hasOwnProperty;var $=(s,o)=>{for(var r in o)k(s,r,{get:o[r],enumerable:!0})},U=(s,o,r,l)=>{if(o&&typeof o=="object"||typeof o=="function")for(let c of R(o))!E.call(s,c)&&c!==r&&k(s,c,{get:()=>o[c],enumerable:!(l=L(o,c))||l.enumerable});return s};var M=s=>U(k({},"__esModule",{value:!0}),s);var B={};$(B,{default:()=>b});module.exports=M(B);var e=require("@raycast/api"),i=require("react");var N=require("child_process"),A=require("@raycast/api"),C=new Map,I=0,F=3e4,w=(s,o)=>{o(!0),(0,N.exec)("netstat -ano -p tcp",{maxBuffer:2*1024*1024},(r,l)=>{if(r){(0,A.showToast)({style:A.Toast.Style.Failure,title:"Error getting ports",message:"Could not execute netstat command"}),s([]),o(!1);return}let c=[],u=new Set,T=l.split(`
`);for(let h of T){let n=h.trim();if(!n||n.includes("Proto")||n.includes("Conexiones")||n.includes("activas")||n.includes("Direcci\xF3n"))continue;let m=n.split(/\s+/);if(m.length>=5){let P=m[0],t=m[1],a=m[3],f=m[4];P==="TCP"&&(a==="LISTENING"||a==="ESCUCHANDO")&&f&&f!=="0"&&(c.push({localAddress:t,pid:f}),u.add(f))}}let y=Date.now();if(y-I>F||C.size===0)(0,N.exec)("tasklist /fo csv /nh",{timeout:8e3,maxBuffer:2*1024*1024},(h,n)=>{if(!h&&n){C.clear();let P=n.split(`
`);for(let t of P)if(t.trim()){let a=t.match(/"([^"]+)","(\d+)"/);if(a){let f=a[1],v=a[2];C.set(v,f)}}I=y}let m=c.map(P=>({...P,processName:C.get(P.pid)||"Unknown"}));s(m),o(!1)});else{let h=c.map(n=>({...n,processName:C.get(n.pid)||"Unknown"}));s(h),o(!1)}})},S=()=>{C.clear(),I=0};var x=require("child_process"),g=require("@raycast/api"),D=(s,o)=>{if(!s||!/^\d+$/.test(s)){(0,g.showToast)({style:g.Toast.Style.Failure,title:"Invalid PID",message:"PID must be a valid number"});return}(0,x.exec)(`taskkill /PID ${s} /F`,(r,l,c)=>{if(r){let u="Unknown error occurred";r.message.includes("not found")?u="Process not found or already terminated":r.message.includes("Access is denied")?u="Access denied - process may require administrator privileges":r.message.includes("terminate")?u="Unable to terminate process":u=r.message,(0,g.showToast)({style:g.Toast.Style.Failure,title:"Could not kill process",message:u})}else(0,g.showToast)({style:g.Toast.Style.Success,title:"Process terminated",message:`PID ${s} was successfully terminated`}),o&&setTimeout(o,500)})};var d=require("react/jsx-runtime");function z(s,o){let[r,l]=(0,i.useState)(s);return(0,i.useEffect)(()=>{let c=setTimeout(()=>{l(s)},o);return()=>clearTimeout(c)},[s,o]),r}function b(){let[s,o]=(0,i.useState)([]),[r,l]=(0,i.useState)(!0),[c,u]=(0,i.useState)(""),[T,y]=(0,i.useState)(Date.now()),p=z(c,300);(0,i.useEffect)(()=>{w(o,l),y(Date.now())},[]),(0,i.useEffect)(()=>{if(r)return;let t=setInterval(()=>{Date.now()-T>=3e4&&(w(o,l),y(Date.now()))},5e3);return()=>clearInterval(t)},[r,T]);let h=(0,i.useCallback)((t,a)=>{o(s.filter(f=>f.pid!==t)),D(t,()=>{l(!0),w(o,l),y(Date.now()),(0,e.showToast)({style:e.Toast.Style.Success,title:"Process killed",message:`Process on port ${a} terminated`})})},[s]),n=(0,i.useCallback)(()=>{S(),l(!0),w(o,l),y(Date.now()),(0,e.showToast)({style:e.Toast.Style.Success,title:"Refreshed",message:"Port list updated"})},[]),m=(0,i.useMemo)(()=>{if(!p.trim())return s;let t=p.toLowerCase();return s.filter(a=>a.localAddress.toLowerCase().includes(t)||a.pid.includes(t)||a.processName?.toLowerCase().includes(t))},[s,p]),P=(0,i.useMemo)(()=>m.map(t=>{let a=t.localAddress.split(":").pop()||"",f=parseInt(a)<1024;return(0,d.jsx)(e.List.Item,{title:t.localAddress,subtitle:`PID: ${t.pid}`,accessories:[{text:t.processName||"Unknown Process",icon:t.processName?e.Icon.Terminal:e.Icon.QuestionMark,tooltip:t.processName||"Process name not available"},...f?[{icon:e.Icon.Shield,tooltip:"System/Reserved Port"}]:[]],actions:(0,d.jsxs)(e.ActionPanel,{children:[(0,d.jsx)(e.Action,{title:"Kill Process",onAction:()=>h(t.pid,t.localAddress),icon:e.Icon.Trash,shortcut:{modifiers:["ctrl","shift"],key:"k"}}),(0,d.jsx)(e.Action,{title:"Refresh List",onAction:n,icon:e.Icon.ArrowClockwise,shortcut:{modifiers:["ctrl"],key:"r"}}),(0,d.jsx)(e.Action.CopyToClipboard,{content:t.localAddress,title:"Copy Port Address",shortcut:{modifiers:["ctrl"],key:"c"}}),(0,d.jsx)(e.Action.CopyToClipboard,{content:t.pid,title:"Copy Pid",shortcut:{modifiers:["ctrl","shift"],key:"p"}}),(0,d.jsx)(e.Action.CopyToClipboard,{content:t.processName||"",title:"Copy Process Name",shortcut:{modifiers:["ctrl","shift"],key:"n"}})]})},`${t.pid}-${t.localAddress}`)}),[m,h,n]);return(0,d.jsx)(e.List,{isLoading:r,searchBarPlaceholder:"Search ports, PID, or process name...",onSearchTextChange:u,searchText:c,throttle:!0,children:m.length===0&&!r?(0,d.jsx)(e.List.EmptyView,{icon:p?e.Icon.MagnifyingGlass:e.Icon.Network,title:p?"No matching ports found":"No ports found",description:p?`No ports match "${p}"`:"No listening TCP ports detected on your system",actions:(0,d.jsx)(e.ActionPanel,{children:(0,d.jsx)(e.Action,{title:"Refresh",onAction:n,icon:e.Icon.ArrowClockwise})})}):(0,d.jsx)(e.List.Section,{title:`${m.length} Active Ports`,children:P})})}
