"use strict";var X=Object.create;var L=Object.defineProperty;var Z=Object.getOwnPropertyDescriptor;var Q=Object.getOwnPropertyNames;var q=Object.getPrototypeOf,_=Object.prototype.hasOwnProperty;var ee=(e,r)=>()=>(r||e((r={exports:{}}).exports,r),r.exports),te=(e,r)=>{for(var a in r)L(e,a,{get:r[a],enumerable:!0})},O=(e,r,a,n)=>{if(r&&typeof r=="object"||typeof r=="function")for(let i of Q(r))!_.call(e,i)&&i!==a&&L(e,i,{get:()=>r[i],enumerable:!(n=Z(r,i))||n.enumerable});return e};var P=(e,r,a)=>(a=e!=null?X(q(e)):{},O(r||!e||!e.__esModule?L(a,"default",{value:e,enumerable:!0}):a,e)),re=e=>O(L({},"__esModule",{value:!0}),e);var w=ee(m=>{"use strict";var T=m&&m.__assign||function(){return T=Object.assign||function(e){for(var r,a=1,n=arguments.length;a<n;a++){r=arguments[a];for(var i in r)Object.prototype.hasOwnProperty.call(r,i)&&(e[i]=r[i])}return e},T.apply(this,arguments)},ae=m&&m.__importStar||function(e){if(e&&e.__esModule)return e;var r={};if(e!=null)for(var a in e)Object.hasOwnProperty.call(e,a)&&(r[a]=e[a]);return r.default=e,r};Object.defineProperty(m,"__esModule",{value:!0});var oe=ae(require("child_process"));function B(e){return Array.isArray(e)&&Object.prototype.hasOwnProperty.call(e,"raw")}function ne(e,r){for(var a="",n=e.length,i=0;i<n;i++){var p=i<n-1?r[i]:"";a+=e[i]+p}return a.trim()}function v(e,r,a){return a===void 0&&(a={}),process.platform!=="darwin"?Promise.reject(new Error("osascript-tag requires macOS")):new Promise(function(n,i){var p=a.argv||[],s=[],y=ne(e,r),K="AppleScript";a.language==="JavaScript"&&(K=a.language,y="(function(...argv){"+y+"})("+p.map(function(c){return JSON.stringify(c)})+")"),a.parse&&(s=["-s","s"]),typeof a.flags=="string"&&(s=["-s",a.flags]);var h=oe.spawn("osascript",["-l",K].concat(s,["-e",y])),x="";h.stderr.on("data",function(c){x+=c.toString()});var k="";h.stdout.on("data",function(c){k+=c.toString()}),h.on("close",function(){if(x)i(x);else{var c=k;if(a.parse)try{c=JSON.parse(k)}catch(b){i(b)}n(c)}}),h.on("error",function(c){i(c)})})}function N(e){for(var r=[],a=1;a<arguments.length;a++)r[a-1]=arguments[a];return B(e)?v(e,r,{}):function(n){for(var i=[],p=1;p<arguments.length;p++)i[p-1]=arguments[p];return v(n,i,e)}}function M(e){for(var r=[],a=1;a<arguments.length;a++)r[a-1]=arguments[a];return B(e)?v(e,r,{language:"JavaScript"}):function(n){for(var i=[],p=1;p<arguments.length;p++)i[p-1]=arguments[p];return v(n,i,T({language:"JavaScript"},e))}}N.jxa=M;m.jxa=M;m.default=N});var ke={};te(ke,{default:()=>xe});module.exports=re(ke);var u=require("@raycast/api"),R=require("react");var E=require("react"),A=require("@raycast/api"),F=P(w()),ie=A.Toast.Style,pe=({appExists:e,appName:r},a,n)=>{let[i,p]=(0,E.useState)({isLoading:!0,results:[]});return(0,E.useEffect)(()=>{if(!e||a.length===0){p(s=>({...s,isLoading:!1}));return}Promise.resolve().then(()=>p(s=>({...s,isLoading:!0}))).then(()=>se(r,n,a)).then(s=>p(y=>({...y,results:s}))).catch(I).finally(()=>p(s=>({...s,isLoading:!1})))},[e,a,n]),i},U=pe,se=async(e,r,a)=>{let n=await(0,F.jxa)({parse:!0})`
      const DT = Application("${e}");

      let results;

      if ("${r}" === "") {
          results = DT.search('${a.replaceAll("'","\\'")}');
      } else {
          const database = DT.getRecordWithUuid("${r}");
          results = DT.search('${a.replaceAll("'","\\'")}', {in: database});
      }


      if (results.length === 0) {
          return "[]";
      }

      return JSON.stringify(results.slice(0, 20).map(result => result.properties()));
  `;return JSON.parse(n).sort((p,s)=>s.score-p.score)},I=e=>(console.log(e),(0,A.showToast)(ie.Failure,"Failed to perform the operation",e));var l=require("@raycast/api"),t=require("react/jsx-runtime"),le=({result:e})=>(0,t.jsx)(l.List.Item,{title:e.name,icon:{fileIcon:e.path},actions:(0,t.jsxs)(l.ActionPanel,{children:[(0,t.jsx)(l.Action.Open,{title:"Open in DEVONthink",target:`x-devonthink-item://${e.uuid}`}),(0,t.jsx)(l.Action.Open,{title:"Open in the default app",target:e.path}),(0,t.jsx)(l.Action.CopyToClipboard,{title:"Copy Item Link",content:`x-devonthink-item://${e.uuid}`}),(0,t.jsx)(l.Action.CopyToClipboard,{title:"Copy Markdown Link",content:`[${e.name}](x-devonthink-item://${e.uuid})`}),(0,t.jsx)(l.Action.Open,{title:"Reveal in DEVONthink",target:`x-devonthink-item://${e.uuid}?reveal=1`})]}),detail:(0,t.jsx)(l.List.Item.Detail,{metadata:(0,t.jsx)(l.List.Item.Detail.Metadata,{children:ce(e)})})}),J=le,f=(0,l.getPreferenceValues)(),ce=e=>{let r=[(0,t.jsx)(o,{propKey:"propertyName",title:"Name",text:e.name},"name"),(0,t.jsx)(j,{title:"Tags",children:e.tags.map(p=>(0,t.jsx)(ye,{text:p},p))},"tags"),(0,t.jsx)($,{propKey:"propertyUrl",title:"URL",text:H(e.url),target:e.url},"url"),(0,t.jsx)(o,{propKey:"propertyCreationDate",title:"Creation Date",text:D(e.creationDate)},"creationDate"),(0,t.jsx)(o,{propKey:"propertyModificationDate",title:"Modification Date",text:D(e.modificationDate)},"modificationDate"),(0,t.jsx)(o,{propKey:"propertyOpeningDate",title:"Opening Date",text:D(e.openingDate)},"openingDate"),(0,t.jsx)(o,{propKey:"propertyAdditionDate",title:"Addition Date",text:D(e.additionDate)},"additionDate"),(0,t.jsx)(o,{propKey:"propertyDate",title:"Date",text:D(e.date)},"date"),(0,t.jsx)(o,{propKey:"propertyLocation",title:"Location",text:e.location},"location"),(0,t.jsx)(o,{propKey:"propertySize",title:"Size",text:""+de(e.size,f.useSIUnits)},"size"),(0,t.jsx)(o,{propKey:"propertyScore",title:"Score",text:""+e.score},"score"),(0,t.jsx)(o,{propKey:"propertyType",title:"Type",text:e.type},"type"),(0,t.jsx)(o,{propKey:"propertyKind",title:"Kind",text:e.kind},"kind"),(0,t.jsx)($,{propKey:"propertyReferenceURL",title:"Reference URL",text:H(e.referenceURL),target:e.referenceURL},"referenceURL"),(0,t.jsx)(o,{propKey:"propertyPath",title:"Path",text:e.path},"path"),(0,t.jsx)(o,{propKey:"propertyFilename",title:"Filename",text:e.filename},"filename"),(0,t.jsx)(o,{propKey:"propertyLocationGroup",title:"Location Group",text:e.locationGroup},"locationGroup"),(0,t.jsx)(o,{propKey:"propertyMimeType",title:"MIME Type",text:e.mimeType},"mimeType"),(0,t.jsx)(o,{propKey:"propertyUnread",title:"Unread",text:e.unread?"yes":"no"},"unread"),(0,t.jsx)(o,{propKey:"propertyAliases",title:"Aliases",text:e.aliases},"aliases"),(0,t.jsx)(o,{propKey:"propertyComment",title:"Comment",text:e.comment},"comment"),(0,t.jsx)(o,{propKey:"propertyNumberOfHits",title:"Number of Hits",text:""+e.numberOfHits},"numberOfHits"),(0,t.jsx)(o,{propKey:"propertyAnnotationCount",title:"Annotation Count",text:""+e.annotationCount},"annotationCount"),(0,t.jsx)(o,{propKey:"propertyCharacterCount",title:"Character Count",text:""+e.characterCount},"characterCount"),(0,t.jsx)(o,{propKey:"propertyRating",title:"Rating",text:""+e.rating},"rating"),(0,t.jsx)(o,{propKey:"propertyPageCount",title:"Page Count",text:""+e.pageCount},"pageCount"),(0,t.jsx)(o,{propKey:"propertyWordCount",title:"Word Count",text:""+e.wordCount},"wordCount"),(0,t.jsx)(o,{propKey:"propertyAttachmentCount",title:"Attachment Count",text:""+e.attachmentCount},"attachmentCount"),(0,t.jsx)(o,{propKey:"propertyNumberOfDuplicates",title:"Number of Duplicates",text:""+e.numberOfDuplicates},"numberOfDuplicates"),(0,t.jsx)(o,{propKey:"propertyTagType",title:"Tag Type",text:e.tagType},"tagType"),(0,t.jsx)(o,{propKey:"propertyAttachedScript",title:"Attached Script",text:e.attachedScript},"attachedScript"),(0,t.jsx)(o,{propKey:"propertyClass",title:"Class",text:e.class},"class"),(0,t.jsx)(o,{propKey:"propertyHeight",title:"Height",text:""+e.height},"height"),(0,t.jsx)(o,{propKey:"propertyWidth",title:"Width",text:""+e.width},"width"),(0,t.jsx)(o,{propKey:"propertyDpi",title:"DPI",text:""+e.dpi},"dpi"),(0,t.jsx)(o,{propKey:"propertyAltitude",title:"Altitude",text:""+e.altitude},"altitude"),(0,t.jsx)(o,{propKey:"propertyLatitude",title:"Latitude",text:""+e.latitude},"latitude"),(0,t.jsx)(o,{propKey:"propertyLongitude",title:"Longitude",text:""+e.longitude},"longitude"),(0,t.jsx)(o,{propKey:"propertyID",title:"ID",text:""+e.id},"id"),(0,t.jsx)(o,{propKey:"propertyUUID",title:"UUID",text:e.uuid},"uuid"),(0,t.jsx)(o,{propKey:"propertyContentHash",title:"Content Hash",text:e.contentHash},"contentHash"),(0,t.jsx)(o,{propKey:"propertyInterval",title:"Interval",text:""+e.interval},"interval"),(0,t.jsx)(o,{propKey:"propertyNumberOfReplicants",title:"Number of Replicants",text:""+e.numberOfReplicants},"numberOfReplicants"),(0,t.jsx)(o,{propKey:"propertyBatesNumber",title:"Bates Number",text:""+e.batesNumber},"batesNumber"),(0,t.jsx)(o,{propKey:"propertyDuration",title:"Duration",text:""+e.duration},"duration"),(0,t.jsx)(o,{propKey:"propertyLabel",title:"Label",text:""+e.label},"label"),(0,t.jsx)(o,{propKey:"propertyState",title:"State",text:e.state?"yes":"no"},"state"),(0,t.jsx)(o,{propKey:"propertyExcludeFromTagging",title:"Exclude from Tagging",text:e.excludeFromTagging?"yes":"no"},"excludeFromTagging"),(0,t.jsx)(o,{propKey:"propertyStateVisibility",title:"State Visibility",text:e.stateVisibility?"yes":"no"},"stateVisibility"),(0,t.jsx)(o,{propKey:"propertyExcludeFromWikiLinking",title:"Exclude from Wiki Linking",text:e.excludeFromWikiLinking?"yes":"no"},"excludeFromWikiLinking"),(0,t.jsx)(o,{propKey:"propertyExcludeFromClassification",title:"Exclude from Classification",text:e.excludeFromClassification?"yes":"no"},"excludeFromClassification"),(0,t.jsx)(o,{propKey:"propertyLocking",title:"Locking",text:e.locking?"yes":"no"},"locking"),(0,t.jsx)(o,{propKey:"propertyIndexed",title:"Indexed",text:e.indexed?"yes":"no"},"indexed"),(0,t.jsx)(o,{propKey:"propertyExcludeFromSeeAlso",title:"Exclude from See Also",text:e.excludeFromSeeAlso?"yes":"no"},"excludeFromSeeAlso"),(0,t.jsx)(o,{propKey:"propertyExcludeFromSearch",title:"Exclude from Search",text:e.excludeFromSearch?"yes":"no"},"excludeFromSearch")].concat(ue({propKey:"propertyMetaData",record:e.metaData})),a=f.orderSearchResultItemProperties.split(",").map(p=>p.trim().toLowerCase()),n=[];a.forEach(p=>{let s=r.findIndex(y=>y.key?.toString().toLowerCase()===p);s<0||(n.push(r[s]),r[s]=(0,t.jsx)(t.Fragment,{}))});let i=r.filter(p=>p.key!==null);return n.concat(i)},W=l.List.Item.Detail.Metadata.Label,j=l.List.Item.Detail.Metadata.TagList,ye=j.Item,V=l.List.Item.Detail.Metadata.Link,o=({propKey:e,title:r,text:a})=>f[e]?f.hideEmptySearchResultItemProperties&&!a?null:(0,t.jsx)(W,{title:r,text:a}):null,$=({propKey:e,title:r,text:a,target:n})=>f[e]?f.hideEmptySearchResultItemProperties?n?(0,t.jsx)(V,{title:r,text:a,target:n}):null:n?(0,t.jsx)(V,{title:r,text:a,target:n}):(0,t.jsx)(o,{propKey:e,title:r,text:"No URL"}):null,ue=({propKey:e,record:r})=>f[e]?r===null?(0,t.jsx)(t.Fragment,{}):Object.entries(r).map(([a,n])=>{let i=typeof n=="string"?n:JSON.stringify(n);return(0,t.jsx)(W,{title:a,text:i},a)}):(0,t.jsx)(t.Fragment,{}),D=e=>{let r=new Date(e);return`${r.toLocaleDateString()} ${r.toLocaleTimeString()}`},de=(e,r=!1,a=1)=>{let n=r?1024:1e3;if(Math.abs(e)<n)return e+" B";let i=r?["KiB","MiB","GiB","TiB","PiB","EiB","ZiB","YiB"]:["kB","MB","GB","TB","PB","EB","ZB","YB"],p=-1,s=10**a;do e/=n,++p;while(Math.round(Math.abs(e)*s)/s>=n&&p<i.length-1);return e.toFixed(a)+" "+i[p]},H=e=>e.replace(/^[^:]+:\/\/([^/]+).*$/,"$1");var S=require("react"),g=require("@raycast/api"),me=()=>{let e=["DEVONthink","DEVONthink 3"],[r,a]=(0,S.useState)({appExistsLoading:!0,appExists:!1,appName:""});return(0,S.useEffect)(()=>{(0,g.getApplications)().then(n=>n.find(i=>e.find(p=>i.name===p))).then(n=>a({appExistsLoading:!1,appExists:n!==void 0,appName:n?.name??""}))},[]),(0,S.useEffect)(()=>{r.appExistsLoading||r.appExists||(0,g.showToast)({style:g.Toast.Style.Failure,title:"DEVONthink is not installed",primaryAction:{title:"Download app",onAction:n=>(0,g.open)("https://www.devontechnologies.com/apps/devonthink").then(()=>n.hide())}})},[r.appExistsLoading,r.appExists]),r},G=me;var C=require("react"),z=P(w());var ge=({appExists:e,appName:r})=>{let[a,n]=(0,C.useState)({databasesAreLoading:!0,databases:[]});return(0,C.useEffect)(()=>{if(!e){n(i=>({...i,databasesAreLoading:!1}));return}fe(r).then(i=>n(p=>({...p,databases:i}))).catch(I).finally(()=>n(i=>({...i,databasesAreLoading:!1})))},[e,r]),a},Y=ge,fe=async e=>await(0,z.jxa)({parse:!0})`
        const DT = Application("${e}");

        const databases = DT.databases();

        return databases.map(db => ({
            uuid: db.uuid(),
            name: db.name()
        }))
    `;var d=require("react/jsx-runtime"),he=()=>{let e=G(),[r,a]=(0,R.useState)(""),[n,i]=(0,R.useState)(""),{isLoading:p,results:s}=U(e,r,n),{databasesAreLoading:y,databases:K}=Y(e),h=(0,u.getPreferenceValues)(),x=c=>(0,d.jsx)(J,{result:c},c.uuid),k=(0,d.jsx)(u.List.EmptyView,{title:"You need to have DEVONthink installed",icon:"devonthink-icon-small.png"});return(0,d.jsx)(u.List,{isLoading:e.appExistsLoading||p||y,searchBarPlaceholder:"Search DEVONthink Database...",onSearchTextChange:a,searchBarAccessory:(0,d.jsxs)(u.List.Dropdown,{tooltip:"Select database",onChange:i,storeValue:!0,children:[(0,d.jsx)(u.List.Dropdown.Item,{title:"All databases",value:""}),(0,d.jsx)(u.List.Dropdown.Section,{title:"Specific database",children:K.map(({name:c,uuid:b})=>(0,d.jsx)(u.List.Dropdown.Item,{title:c,value:b},b))})]}),isShowingDetail:h.searchIsShowingDetail&&s.length>0,throttle:!0,children:e.appExists?s.map(x):k})},xe=he;
